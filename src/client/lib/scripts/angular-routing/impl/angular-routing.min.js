/**
 * @license dotJEM Angular Routing
 * (c) 2012-2013 dotJEM (Jens Melgaard)
 * License: MIT
 *
 * @module angular-routing
 */
var dotjem;(function(t,e,r,n){"use strict";function a(t,e){return y(new(y(function(){},{prototype:t})),e)}function o(t){return $(t)?t:t.$fullname||t.fullname}function i(t){if(!E(t))return!1;for(var e=Error("Incorrect injection annotation! Expected an array of strings with the last element as a function"),r=0,n=t.length;n>r;r++)if(n-1>r){if(!$(t[r]))throw e}else if(!g(t[r])&&!$(t[r]))throw e;return!0}function u(t){return i(t)||g(t)}function c(t,e,r){var n=S(t||{});return n.$all=S(t||{}),n.$path=S(e||{}),n.$search=S(r||{}),n}function s(t,e){var r=[];return C(t,function(t,e){r.push(l(e,!0)+(t===!0?"":"="+l(t,!0)))}),r.length?e+r.join("&"):""}function l(t,e){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,e?"%20":"+")}function f(t){return t.replace(R,"\\$&")}function p(){function t(t){var e={handler:{}};return m(t.to)&&(e.to=t.to),m(t.from)&&(e.from=t.from),m(t.handler)&&(e.handler=t.handler),m(t.before)&&v(e.handler.before)&&(e.handler.before=t.before),m(t.between)&&v(e.handler.between)&&(e.handler.between=t.between),m(t.after)&&v(e.handler.after)&&(e.handler.after=t.after),e}function e(t,e){var r=F.validateTarget(t),n=F.validateTarget(e);if(!r||!n){if(r)throw Error("Invalid transition - to: '"+e+"'.");if(n)throw Error("Invalid transition - from: '"+t+"'.");throw Error("Invalid transition - from: '"+t+"', to: '"+e+"'.")}}function r(t){for(var e=n,r=t.split("."),a=r[0]===T?1:0;r.length>a;a++)r[a]in e.children||(e.children[r[a]]={children:{},targets:{}}),e=e.children[r[a]];return e}var n={children:{},targets:{}};this.onEnter=function(e,r){if(b(r)){var n=t(r);this.transition(n.from||"*",e,n.handler)}else(g(r)||E(r))&&this.transition("*",e,r)},this.onExit=function(e,r){if(b(r)){var n=t(r);this.transition(e,n.to||"*",n.handler)}else(g(r)||E(r))&&this.transition(e,"*",r)},this.transition=function(t,n,a){var i,c=this;if(E(t))C(t,function(t){c.transition(t,n,a)});else if(E(n))C(n,function(e){c.transition(t,e,a)});else{if(t=o(t),n=o(n),n===t&&-1===n.indexOf("*"))return this;e(t,n),u(a)&&(a={between:a}),i=r(t),n in i.targets||(i.targets[n]=[]),a.name=t+" -> "+n,i.targets[n].push(a)}return this},this.$get=["$q","$inject",function(t,e){function r(t,r){function n(n,a,o){var u;C(i,function(i){m(u=n(i))&&e.create(u)({$to:r,$from:t,$transition:a,$view:o})})}var a=c(o(t)),i=u(a,o(r));return{before:function(t,e){n(function(t){return t.before},t,e)},between:function(t,e){n(function(t){return t.between},t,e)},after:function(t,e){n(function(t){return t.after},t,e)}}}function a(t){return t[0]===T&&t.splice(0,1),t}function i(t,e){for(var r,n,o=a(t.split(".")).reverse(),i=a(e.split(".")).reverse();;){if(r=o.pop(),n=i.pop(),"*"===n||"*"===r)return!0;if(r!==n)return!1;if(!m(r)||!m(n))return!0}}function u(t,e){var r=[];return C(t,function(t){C(t.targets,function(t,n){i(n,e)&&C(t,function(t){r.push(t)})})}),r}function c(t){var e=n,r=t.split("."),a=[],o=r[0]===T?1:0;do{if("*"in e.children&&a.push(e.children["*"]),!(r[o]in e.children))break;e=e.children[r[o]],a.push(e)}while(o++<r.length);return a}var s={root:n,find:r};return s}]}function h(){var t=RegExp("^(((http|https|ftp)://([\\w-\\d]+\\.)+[\\w-\\d]+){0,1}(/?[\\w~,;\\-\\./?%&+#=]*))","i");this.$get=["$http","$q","$injector","$templateCache",function(e,r,n,a){function o(t){return e.get(t,{cache:a}).then(function(t){return t.data})}function i(t){return r.when(n.invoke(t))}function u(t){if(m(t.url))return o(t.url);if(m(t.fn))return i(t.fn);if(m(t.html))return r.when(t.html);throw Error("Object must define url, fn or html.")}var c={get:function(e){if($(e))return t.test(e)?o(e):r.when(e);if(g(e)||E(e))return i(e);if(b(e))return u(e);throw Error("Template must be either an url as string, function or a object defining either url, fn or html.")}};return c}]}function d(){this.$get=["$rootScope","$q","$template",function(t,e,r){function n(t){if(v(t))throw Error("Must define a view name.")}function a(e){t.$broadcast(A.VIEW_UPDATE,e)}function o(e,r){t.$broadcast(A.VIEW_REFRESH,e,r)}function i(e,r){t.$broadcast(A.VIEW_PREP,e,r)}function u(t,e){return e in t&&null!==t[e]}function c(t){return E.completed?(v(t)?C(b,function(t,e){w.clear(e)}):(delete b[t],a(t)),w):E.clear(t)}function s(t,e){var i=e.template,c=e.controller,s=e.locals,f=e.sticky;return n(t),E.completed?(u(b,t)||(b[t]={version:-1}),b[t].template=r.get(i),b[t].controller=c,b[t].locals=s,l(t,f)?o(t,{$locals:s,sticky:f}):(b[t].version++,b[t].sticky=f,a(t)),w):E.update(t,e)}function l(t,e){return m(e)&&$(e)&&t in b&&b[t].sticky===e}function f(t,e){var o=e.template,i=e.controller,c=e.locals,s=e.sticky;return n(t),E.completed?(u(b,t)||(b[t]={template:r.get(o),controller:i,locals:c,sticky:s,version:0},a(t)),w):E.create(t,e)}function p(t){return v(t)?S(b):S(b[t])}function h(t,e){return E.completed?(v(t)?C(b,function(t,r){w.refresh(r,e)}):(e.$locals=b[t]&&b[t].locals,o(t,e)),w):E.refresh(t,e)}function d(t,e){var r=t in b,n=l(t,e.args.sticky);switch(e.act){case"clear":return"unload";case"update":return n?"refresh":"update";case"create":return r?"keep":"load";case"refresh":return"refresh"}return"invalid"}function g(){function t(){var t,e={};return t={completed:!1,pending:function(t){if(m(t)){var r=e[t];return{action:d(t,r),args:r.args}}var n={};return C(e,function(t,e){n[e]={action:d(e,t)}}),n},commit:function(){return t.completed?t:(t.completed=!0,C(e,function(t){t.fn()}),e={},t)},cancel:function(){return i(name,{type:"cancel"}),t.completed=!0,t},clear:function(r){return v(r)?(C(b,function(e,r){t.clear(r)}),t):(e[r]={act:"clear",args:{name:r},fn:function(){c(r)}},t)},prepUpdate:function(e,r){return i(e,{type:"update"}),function(n){return r.locals=y({},r.locals,n),t.update(e,r),t}},prepCreate:function(e,r){return i(e,{type:"create"}),function(n){return r.locals=y({},r.locals,n),t.create(e,r),t}},update:function(r,a){return n(r),e[r]={act:"update",args:a,fn:function(){s(r,a)}},t},create:function(r,a){return n(r),u(e,r)&&"clear"!==e[r].act||(e[r]={act:"create",args:a,fn:function(){f(r,a)}}),t},refresh:function(r,n){return v(r)?(C(b,function(e,r){t.refresh(r,n)}),t):(e[r]={act:"refresh",args:{name:r,data:n},fn:function(){h(r,n)}},t)},get:p}}if(!E.completed)throw Error("Can't start multiple transactions");return E=t()}var b={},E={completed:!0},w={get:p,clear:c,refresh:h,update:s,create:f,beginUpdate:g};return w}]}angular.module("dotjem.routing",[]);var m=angular.isDefined,v=angular.isUndefined,g=angular.isFunction,$=angular.isString,b=angular.isObject,E=angular.isArray,w=function(t){return"boolean"==typeof t},C=angular.forEach,y=angular.extend,S=angular.copy,x=angular.equals,_=(angular.element,angular.noop),T="$root",R=/[-\/\\^$*+?.()|[\]{}]/g,O={routeCannotBeUndefined:"Can not set route to undefined.",valueCouldNotBeMatchedByRegex:"Value could not be matched by the regular expression parameter.",regexConverterNotValid:"The Regular-expression converter was not initialized with a valid object.",invalidNumericValue:"Value was not acceptable for a numeric parameter.",invalidBrowserPathExpression:"Invalid path expression.",expressionOutOfBounds:"Expression out of bounds.",couldNotFindStateForPath:"Could find state for path."},A={LOCATION_CHANGE:"$locationChangeSuccess",ROUTE_UPDATE:"$routeUpdate",ROUTE_CHANGE_START:"$routeChangeStart",ROUTE_CHANGE_SUCCESS:"$routeChangeSuccess",ROUTE_CHANGE_ERROR:"$routeChangeError",STATE_UPDATE:"$stateUpdate",STATE_CHANGE_START:"$stateChangeStart",STATE_CHANGE_SUCCESS:"$stateChangeSuccess",STATE_CHANGE_ERROR:"$stateChangeError",VIEW_UPDATE:"$viewUpdate",VIEW_REFRESH:"$viewRefresh",VIEW_PREP:"$viewPrep"},P=["$locationProvider",function(t){function e(t){var e=null;return function(r,n){return null===e&&(e=t?$(t)?function(e,r){var n=o(t,r.params);e.path(n).search(r.params).replace()}:function(e,r){e.url(t(r.pathParams,e.path(),e.search())).replace()}:_),e(r,n)}}function r(t,e,r){var n;if(r&&(n=r.trim(),"{"===n[0]&&"}"===n[n.length-1]||"["===n[0]&&"]"===n[n.length-1]))try{r=angular.fromJson(n)}catch(a){}return{name:t,converter:function(){return h[e](r)}}}function o(t,e){var n="",a=0;return C(i(t),function(o){var i=function(t){return""+t},u=r(o.name,o.converter,o.args).converter(),c=e[o.name];if(v(c))throw Error("Could not find parameter '"+o.name+"' when building url for route '"+t+"', ensure that all required parameters are provided.");!g(u)&&m(u.format)&&(i=u.format),n+=t.slice(a,o.index)+"/"+i(c),a=o.lastIndex,delete e[o.name]}),n+=t.substr(a)}function i(t){var e,r=[];if(null===t)return r;for(;null!==(e=w.exec(t));)r.push({name:e[4]||e[11],catchAll:"*"===(e[3]||e[10]),converter:e[7]||"",args:e[9],index:e.index,lastIndex:w.lastIndex});return r}function u(t){var e="^",n="",a=[],o=0,u="",c={};return null===t?{name:null,params:c}:"/"===t?{exp:RegExp("^[/]?$",u),segments:[],name:n,params:c}:(C(i(t),function(i,u){var s="";e+=f(t.slice(o,i.index)),e+=i.catchAll?"/(.*)":"/([^\\/]*)",""!==i.converter&&(s=":"+i.converter),n+=t.slice(o,i.index)+"/$"+u+s,c[i.name]={id:u,converter:i.converter},a.push(r(i.name,i.converter,i.args)),o=i.lastIndex}),e+=f(t.substr(o)),n+=t.substr(o),E||(n=n.toLowerCase(),u+="i"),"/"===e[e.length-1]&&(e=e.substr(0,e.length-1)),{exp:RegExp(e+"/?$",u),segments:a,name:n,params:c})}function c(t,e){return null==t?_:function(t){var r,a=t.match(e.exp),o={};return a&&(r=!1,C(e.segments,function(t,e){var n,i,u;r||(n=a[e+1],u=t.converter(),!g(u)&&m(u.parse)&&(u=u.parse),i=u(n),m(i.accept)?(i.accept||(r=!0),o[t.name]=i.value):(i||(r=!0),o[t.name]=n))}),!r)?o:n}}var l=this,p={},h={},d={},E=!0;this.convert=function(t,e){return h[t]=e,l},this.when=function(t,r){var n=u(t);return p[n.name]={self:y({reloadOnSearch:!0},r),redirect:e(r.redirectTo),match:c(t,n),params:n.params,path:t},{convert:l.convert,when:l.when,otherwise:l.otherwise,decorate:l.decorate,ignoreCase:l.ignoreCase,matchCase:l.matchCase,$route:{name:n.name,params:S(n.params),route:t}}},this.otherwise=function(t){return l.when(null,t),l},this.decorate=function(t,e){return d[t]=e,l},this.ignoreCase=function(){return E=!1,l},this.matchCase=function(){return E=!0,l};var w=RegExp("/((:(\\*?)(\\w+))|(\\{((\\w+)(\\((.*?)\\))?:)?(\\*?)(\\w+)\\}))","g");this.convert("num",function(){return{parse:function(t){var e=!isNaN(t);return{accept:e,value:e?Number(t):0}},format:function(t){if(isNaN(t))throw Error(O.invalidNumericValue);return""+t}}}),this.convert("regex",function(t){var e,r,n="";if(b(t)&&m(t.exp))e=t.exp,m(t.flags)&&(n=t.flags);else{if(!($(t)&&t.length>0))throw Error(O.regexConverterNotValid);e=t}return r=RegExp(e,n),{parse:function(t){var e=r.test(t);return{accept:e,value:e?r.exec(t):null}},format:function(t){var e=""+t,n=r.test(e);if(!n)throw Error(O.valueCouldNotBeMatchedByRegex);return e}}}),this.convert("",function(){return function(){return!0}}),this.$get=["$rootScope","$location","$q","$injector","$routeParams","$browser",function(e,r,i,u,c,l){function f(t,e,r){var n=a(t,{self:a(t.self,{params:y({},r,e),searchParams:r,pathParams:e})});return n}function h(t){var e,n;return C(p,function(a){!n&&(e=a.match(t))&&(n=f(a,e,r.search()))}),n||p[null]&&f(p[null],{},{})}function v(){var t=h(r.path()),a=$.current,o=t?t.self:n;if(!g&&o&&a&&angular.equals(o.pathParams,a.pathParams)&&!o.reloadOnSearch)a.params=o.params,a.searchParams=o.searchParams,a.pathParams=o.pathParams,S(o.params,c),e.$broadcast(A.ROUTE_UPDATE,a);else if(t||a){g=!1;var s=e.$broadcast(A.ROUTE_CHANGE_START,o,a);if(!s.defaultPrevented){$.current=o,t&&t.redirect(r,o);var l=i.when(o);o&&C(d,function(t){l=l.then(function(){var e=u.invoke(t,o,{$next:o});return i.when(e)})}),l.then(function(){o===$.current&&(t&&angular.copy(o.params,c),e.$broadcast(A.ROUTE_CHANGE_SUCCESS,o,a))},function(t){o===$.current&&e.$broadcast(A.ROUTE_CHANGE_ERROR,o,a,t)})}}}var g=!1,$={routes:p,html5Mode:function(){return t.html5Mode()},hashPrefix:function(){return t.hashPrefix()},reload:function(){g=!0,e.$evalAsync(v)},change:function(t){var e=t.params||{},n=o(t.route,e),a=r.path(n).search(e);t.replace&&a.replace()},format:function(e,r,n){var a;return r=r||{},n=m(n)?n:!0,a=o(e,r)+s(r,"?"),t.html5Mode()&&n&&(a=(l.baseHref()+a).replace(/\/\//g,"/")),a}};return e.$on(A.LOCATION_CHANGE,v),$}]}];angular.module("dotjem.routing").provider("$route",P).value("$routeParams",{}),angular.module("dotjem.routing").provider("$stateTransition",p);var j=["$routeProvider","$stateTransitionProvider",function(t,e){var r=new B(t,e),a=r.createState(T,{}),i=new H(a);this.state=function(t,e){F.validateName(t);var n=i.lookup(t,1);return n.add(r.createState(t,e,n)),this},this.$get=["$rootScope","$q","$inject","$route","$view","$stateTransition","$location","$scroll","$resolve",function(t,e,r,u,s,l,f,p,h){function d(e){m(e)?$(e)||b(e)?(E=o(e),0!==E.indexOf(T)&&(E=T+"."+E)):e&&(E=a.fullname):E=S.fullname,t.$evalAsync(function(){v({state:S,params:x.params,fource:E})})}function v(n){var a,c,f=!1;R.ended||R.abort(),a=R=_.next(function(t){_=t}),a=a.execute(q.initializeContext(o(n.state),n.params,i)).execute(function(t){t.promise=e.when(""),t.locals={}}).execute(q.createEmitter(l)).execute(q.buildChanges(E)).execute(q.createTransition(v)).execute(function(){E=null}).execute(q.raiseUpdate(t)).execute(q.updateRoute(u,n.updateroute)).execute(q.beginTransaction(s,r)).execute(q.before()).execute(function(e){t.$broadcast(A.STATE_CHANGE_START,e.toState,x.current).defaultPrevented&&e.abort()}),a.ended||(C(a.changed.array,function(t){a.promise=a.promise.then(function(){return(f=f||t.isChanged)&&h.clear(t.state.resolve),h.all(t.state.resolve,_.locals,{$to:a.toState,$from:x.current})}).then(function(e){a.completePrep(t.state.fullname,_.locals=y({},_.locals,e)),c=t.state.scrollTo})}),a.promise.then(function(){a.execute(q.between(t)).execute(function(e){S=e.to;var r=x.current;x.params=e.params,x.current=e.toState,e.transaction.commit(),t.$broadcast(A.STATE_CHANGE_SUCCESS,e.toState,r)}).execute(q.after(p,c)).complete()},function(e){a.execute(function(r){t.$broadcast(A.STATE_CHANGE_ERROR,r.toState,x.current,e),r.abort()})}))}var g=new M(u),E=null,S=a,x={root:a,current:y(a.self,{$params:c()}),params:c(),"goto":function(t,e){v({state:t,params:c(e),updateroute:!0})},lookup:function(t){return i.resolve(S,t,!0)},reload:d,url:function(t,e,r){var a=S;return 0===arguments.length?g.buildUrl(x.current,a,n,n):1===arguments.length?w(t)?g.buildUrl(x.current,a,n,t):(a=i.resolve(S,o(t),!1),g.buildUrl(x.current,a,n,n)):(m(t)&&(a=i.resolve(S,o(t),!1)),w(e)?g.buildUrl(x.current,a,n,e):g.buildUrl(x.current,a,e,r))},is:function(t){return S.is(o(t))},isActive:function(t){return S.isActive(o(t))}};t.$on(A.ROUTE_CHANGE_SUCCESS,function(){var t=u.current;t?t.state&&v({state:t.state,params:c(t.params,t.pathParams,t.searchParams)}):v({state:a,params:c()})}),t.$on(A.ROUTE_UPDATE,function(){var e=u.current,r=c(e.params,e.pathParams,e.searchParams);x.params=r,x.current.$params=r,t.$broadcast(A.STATE_UPDATE,x.current)});var _=new D(x,function(){},a).complete(),R=_;return x}]}];angular.module("dotjem.routing").provider("$state",j);var U=[function(){this.$get=["$q","$inject",function(t,e){var r={},n={};return r.push=function(t,e){n[t]=e},r.clear=function(t){w(t)&&t&&(n={}),$(t)?delete n[t]:b(t)?angular.forEach(t,function(t,e){r.clear(e)}):E(t)&&angular.forEach(t,function(t){r.clear(t)})},r.all=function(r,a,o){var i=[],u=[],c=t.defer();return angular.forEach(r,function(t,r){var s;u.push(r);try{r in n||($(t)?n[r]=angular.isString(t):(s=e.create(t))&&(n[r]=s(y({},a,o)))),i.push(n[r])}catch(l){c.reject("Could not resolve "+r+", error was: "+l)}}),t.all(i).then(function(t){var e={};angular.forEach(t,function(t,r){e[u[r]]=t}),c.resolve(e)},function(t){c.reject(t)}),c.promise},r}]}];angular.module("dotjem.routing").provider("$resolve",U),angular.module("dotjem.routing").provider("$template",h),angular.module("dotjem.routing").provider("$view",d);var N=[function(){this.$get=["$window","$rootScope","$anchorScroll","$inject",function(t,e,r,a){function o(r){return i.$current=r,"top"===r?(t.scrollTo(0,0),n):(e.$broadcast("$scrollPositionChanged",r),n)}var i=function(t){var e;v(t)?r():$(t)?o(t):(e=a.create(t))&&o(e())};return i.$current="top",i}]}];angular.module("dotjem.routing").provider("$scroll",N);var k=[function(){this.$get=["$injector",function(t){function e(e){if(u(e)){var r=new I(e,t);return function(t){return r.invoker(t)}}return null}return{get:t.get,annotate:t.annotate,instantiate:t.instantiate,invoke:t.invoke,accepts:u,create:e}}]}];angular.module("dotjem.routing").provider("$inject",k);var I=function(){function t(t,e){this.fn=t,this.$inject=e,E(t)?this.func=t[t.length-1]:g(t)&&(this.func=t)}return t.FN_ARGS=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,t.FN_ARG_SPLIT=/,/,t.FN_ARG=/^\s*(_?)(\S+?)\1\s*$/,t.STRIP_COMMENTS=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,t.prototype.invoker=function(t){return this.$inject.invoke(this.fn,this.func,t)},t}(),V=function(){function t(t,e,r,n){this._name=t,this._fullname=e,this._parent=n,this._children={},this._self=r,this._self.$fullname=e,this._reloadOnOptional=!m(r.reloadOnSearch)||r.reloadOnSearch,this._scrollTo="top",n&&m(n.scrollTo)&&(this._scrollTo=n.scrollTo),m(this._self.scrollTo)&&(this._scrollTo=this._self.scrollTo)}return Object.defineProperty(t.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullname",{get:function(){return this._fullname},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reloadOnOptional",{get:function(){return this._reloadOnOptional},set:function(t){this._reloadOnOptional=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"self",{get:function(){return S(this._self)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"route",{get:function(){return this._route},set:function(t){if(v(t))throw Error(O.routeCannotBeUndefined);this._route=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return null===this.parent?this:this._parent.root},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollTo",{get:function(){return this._scrollTo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"views",{get:function(){return this.self.views},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resolve",{get:function(){return this.self.resolve},enumerable:!0,configurable:!0}),t.prototype.add=function(t){return this._children[t.name]=t,this},t.prototype.resolveRoute=function(){return m(this.route)?this.route.route:m(this.parent)?this.parent.resolveRoute():""},t.prototype.is=function(t){return this.fullname===t||this.fullname===T+"."+t},t.prototype.isActive=function(t){return this.is(t)?!0:this.parent&&this.parent.isActive(t)||!1},t}(),H=function(){function t(t){this.root=t,this.nameRegex=RegExp("^("+f(T)+"\\.)?\\w+(\\.\\w+)*$"),this.siblingRegex=RegExp("^\\$node\\(([-+]?\\d+)\\)$"),this.indexRegex=RegExp("^\\[(-?\\d+)\\]$")}return t.prototype.lookup=function(t,e){for(var r=this.root,n=t.split("."),a=n[0]===T?1:0,e=m(e)?e:0;n.length-e>a;a++){if(!(n[a]in r.children))throw Error("Could not locate '"+n[a]+"' under '"+r.fullname+"'.");r=r.children[n[a]]}return r},t.prototype.resolve=function(t,e,r){var a,o=this,i=this.siblingRegex.exec(e),u=t;if(i?u=this.selectSibling(Number(i[1]),u):this.nameRegex.test(e)?u=this.lookup(e):(a=e.split("/"),C(a,function(e){u=o.select(t,e,u)})),u===this.root)throw Error(O.expressionOutOfBounds);return u?r?S(u.self):u:n},t.prototype.selectSibling=function(t,e){var r=[],n=0;for(C(e.parent.children,function(t){r.push(t),e.fullname===t.fullname&&(n=r.length-1)});0>t;)t+=r.length;return t=(n+t)%r.length,r[t]},t.prototype.select=function(t,e,r){if("."===e){if(t!==r)throw Error(O.invalidBrowserPathExpression);return r}if(".."===e){if(v(r.parent))throw Error(O.expressionOutOfBounds);return r.parent}if(""===e){if(t!==r)throw Error(O.invalidBrowserPathExpression);return this.root}var n=this.indexRegex.exec(e);if(n){var a=Number(n[1]),o=[];if(C(r.children,function(t){o.push(t)}),Math.abs(a)>=o.length)throw Error(O.expressionOutOfBounds);return 0>a?o[o.length+a]:o[a]}if(e in r.children)return r.children[e];throw Error(O.couldNotFindStateForPath+": "+e)},t}(),G=function(){function t(){}return t.prototype.buildStateArray=function(t,e){function r(){var t={};return a.route&&C(a.route.params,function(r,n){t[n]=e[n]}),t}var n=[],a=t;do n.push({state:a,params:r()});while(a=a.parent);return n},t.prototype.compare=function(t,e,r,n,a){for(var o,i,u=this.buildStateArray(t,r||{}),c=this.buildStateArray(e,n),s=Math.max(u.length,c.length),l=!1,f=!x(r,n),p=0;s>p;p++)o=u[u.length-p-1],i=c[c.length-p-1],v(i)?c[0].isChanged=l=!0:i.isChanged=v(o)||a===i.state.fullname||i.state.fullname!==o.state.fullname||!x(i.params,o.params)?l=!0:!1;return c[0].isChanged=l=l||c[0].state.reloadOnOptional&&f,{array:c.reverse(),stateChanges:l,paramChanges:f}},t}(),B=function(){function t(t,e){this.routes=t,this.transitions=e}return t.prototype.createRoute=function(t,e,r,n){var a=e||"";return""!==a&&"/"===a[a.length-1]&&(a=a.substr(0,a.length-1)),"/"!==t[0]&&""!==t&&(a+="/"),a+=t,this.routes.when(a,{state:r,reloadOnSearch:n})},t.prototype.createState=function(t,e,r){var n=this,a=t.split(".").pop();m(r)&&(t=r.fullname+"."+a);var o=new V(a,t,e,r);return o.reloadOnOptional=!m(e.reloadOnSearch)||e.reloadOnSearch,m(e.route)&&(o.route=this.createRoute(e.route,r.resolveRoute(),o.fullname,o.reloadOnOptional).$route),m(e.onEnter)&&this.transitions.onEnter(o.fullname,e.onEnter),m(e.onExit)&&this.transitions.onExit(o.fullname,e.onExit),m(e.children)&&C(e.children,function(t,e){o.add(n.createState(o.fullname+"."+e,t,o))}),o},t}(),F=function(){function t(){}return t.nameValidation=/^\w+(\.\w+)*?$/,t.targetValidation=/^\$?\w+(\.\w+)*(\.[*])?$/,t.validateName=function(e){if(!t.nameValidation.test(e)||e===T)throw Error("Invalid name: '"+e+"'.")},t.validateTarget=function(e){return"*"===e||t.targetValidation.test(e)?!0:!1},t}(),M=function(){function t(t){this.route=t}return t.prototype.buildUrl=function(t,e,r,n){var a=t;if(!e.route)throw Error("Can't build url for a state that doesn't have a url defined.");var o={},i=a&&a.$params.$all||{};return C(e.route.params,function(t,e){e in i&&(o[e]=i[e])}),this.route.format(e.route.route,y(o,r||{}),n)},t}(),q={initializeContext:function(t,e,r){return function(n){var a=r.resolve(n.from,t,!1);n.to=a,n.params=e,n.toState=y({},a.self,{$params:e})}},createEmitter:function(t){return function(e){e.emit=t.find(e.$state.current,e.toState)}},buildChanges:function(t){return function(e){e.changed=(new G).compare(e.from,e.to,e.$state.params,e.params,t)}},createTransition:function(t){return function(e){var r={locals:e.locals,canceled:!1,cancel:function(){r.canceled=!0},"goto":function(e,n){r.canceled=!0,t({state:e,params:{all:n},updateroute:!0})}};e.transition=r}},raiseUpdate:function(t){return function(e){var r=e.changed,n=e.$state;r.stateChanges||(r.paramChanges&&(n.params=e.params,n.current.$params=e.params,t.$broadcast("$stateUpdate",n.current)),e.abort())}},updateRoute:function(t,e){return function(r){var n=r.to.route;if(e&&n){var a={},o=r.$state.params.$all;C(n.params,function(t,e){e in o&&(a[e]=o[e])});var i=y(a,r.params.$all);t.change(y({},n,{params:i})),r.abort()}}},before:function(){return function(t){t.emit.before(t.transition,t.transaction),t.transition.canceled&&t.abort()}},between:function(t){return function(e){e.emit.between(e.transition,e.transaction),e.transition.canceled&&(t.$broadcast("$stateChangeAborted",e.toState,e.$state.current),e.abort())}},after:function(t,e){return function(r){r.transition.canceled||(r.transition.cancel=function(){throw Error("Can't cancel transition in after handler")},r.emit.after(r.transition,r.transaction),t(e))}},beginTransaction:function(t,e){return function(r){r.transaction=t.beginUpdate(),r.transaction.clear();var n=!1;C(r.changed.array,function(t){n=n||t.isChanged,C(t.state.views,function(a,o){var i;m(a.sticky)&&((i=e.create(a.sticky))?a.sticky=i({$to:r.toState,$from:r.$state.current}):$(a.sticky)||(a.sticky=t.state.fullname)),n||a.force||m(a.sticky)?r.prepUpdate(t.state.fullname,o,a):r.prepCreate(t.state.fullname,o,a)})})}}},D=function(){function t(t,e,r){this.aborted=!1,this.completed=!1,this._prep={},this._$state=t,this.to=r,this.onComplete=e}return Object.defineProperty(t.prototype,"$state",{get:function(){return this._$state},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ended",{get:function(){return this.aborted||this.completed},enumerable:!0,configurable:!0}),t.prototype.next=function(e){this.ended||this.abort();var r=new t(this.$state,e);return r.previous=this,r.from=this.to,this.previous=null,r},t.prototype.execute=function(t){return!this.ended&&(t(this),this.aborted)?this.previous:this},t.prototype.complete=function(){return this.ended||(this.onComplete(this),this.completed=!0),this},t.prototype.abort=function(){return this.ended||(this.aborted=!0,this.transaction&&!this.transaction.completed&&this.transaction.cancel()),this},t.prototype.prepUpdate=function(t,e,r){var n=this._prep[t]=this._prep[t]||{};n[e]=this.transaction.prepUpdate(e,r)},t.prototype.prepCreate=function(t,e,r){var n=this._prep[t]=this._prep[t]||{};n[e]=this.transaction.prepCreate(e,r)},t.prototype.completePrep=function(t,e){C(this._prep[t],function(t){t(e)})},t}(),W=["$state","$compile","$controller","$view","$animate","$template",function(t,e,r,a,o,i){return{restrict:"ECA",terminal:!0,priority:1e3,transclude:"element",compile:function(t,u,c){return function(t,u,s){function l(){m($)&&($.remove(),$=n,u.contents().show())}function f(){null!==C&&C.then(function(t){u.contents().hide(),u.append($=angular.element(t))})}function p(t){d&&(d.$destroy(),d=null),v&&(t?o.leave(v):v.remove(),v=null)}function h(n){var i,s=a.get(b);if(s&&s.template){if(s.version===w)return;w=s.version,i=s.controller,s.template.then(function(a){var l=t.$new();c(l,function(t){p(n),t.html(a),n?o.enter(t,null,u):u.after(t);var c,f=e(t.contents());d=l,v=t,i&&(c=y({},s.locals),c.$scope=d,i=r(i,c),t.data("$ngControllerController",i),t.children().data("$ngControllerController",i)),f(d),d.$emit("$viewContentLoaded"),d.$eval(E)})})}else w=-1,p(n)}var d,v,$,b=s.jemView||s.name,E=s.onload||"",w=-1,C=s.loader&&i.get(s.loader)||null;t.$on(A.VIEW_UPDATE,function(t,e){e===b&&h(!0)}),t.$on(A.VIEW_REFRESH,function(t,e,r){e===b&&(g(d.refresh)?d.refresh(r):d.$broadcast("$refresh",e,r))}),t.$on("$viewPrep",function(t,e,r){e===b&&"update"===r.type?f():"cancel"===r.type&&l()}),h(!1)}}}}];angular.module("dotjem.routing").directive("jemView",W);var L=["$scroll","$timeout",function(t,e){return{restrict:"AC",terminal:!1,link:function(r,n,a){function o(t){t===i&&e(function(){n[0].scrollIntoView()},u)}var i=a.jemAnchor||a.id,u=m(a.delay)?Number(a.delay):1;r.$on("$scrollPositionChanged",function(t,e){o(e)}),o(t.$current)}}}];angular.module("dotjem.routing").directive("jemAnchor",L),angular.module("dotjem.routing").directive("id",L);var z=["$state","$route",function(t,e){return{restrict:"AC",link:function(r,n,a){function o(){var e=r.$eval(a.sref),o=r.$eval(a.params),i=t.url(e,o);s||(i="#"+l+i),n.attr(f[c],i)}function i(){var e=r.$eval(a.sref);t.isActive(e)?n.addClass(a.activeClass):n.removeClass(a.activeClass)}function u(){r.$apply(function(){var e=r.$eval(a.sref),n=r.$eval(a.params);t.goto(e,n)})}var c=n[0].tagName.toLowerCase(),s=e.html5Mode(),l=e.hashPrefix(),f={a:"href",form:"action"},p=_;m(a.activeClass)&&(p=i);var h=r.$on(A.STATE_CHANGE_SUCCESS,p);p(),c in f?(m(a.params)&&r.$watch(a.params,o,!0),a.$observe("sref",o)):n.bind("click",u),r.$on("$destroy",function(){n.unbind("click",u),h()})}}}];angular.module("dotjem.routing").directive("sref",z),r.State=V,r.StateBrowser=H,r.StateComparer=G,r.StateFactory=B,r.StateRules=F,r.StateUrlBuilder=M,r.RootName=T})(window,document,dotjem||(dotjem={}));